---
import '../styles/globals.css';
import Header from '../components/Header.astro';
import Footer from '../components/Footer.astro';
import SEO from '../components/SEO.astro';
import CommandPalette from '../components/CommandPalette.astro';
import { siteConfig } from '../config';

interface Props {
  title: string;
  description?: string;
  image?: string;
  article?: boolean;
  publishedTime?: string;
  tags?: string[];
}

const { 
  title, 
  description = siteConfig.description, 
  image = siteConfig.seo.ogImage,
  article = false,
  publishedTime,
  tags = []
} = Astro.props;

const currentPath = Astro.url.pathname;
---

<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <meta name="generator" content={Astro.generator} />
    <title>{title}</title>
    <SEO 
      title={title} 
      description={description} 
      image={image}
      article={article}
      publishedTime={publishedTime}
      tags={tags}
    />
    <!-- Apply theme before paint to prevent flash -->
    <script is:inline data-default-theme={siteConfig.theme.defaultTheme}>
      (function() {
        const defaultTheme = document.currentScript?.getAttribute('data-default-theme') || 'clean-white';
        const savedTheme = localStorage.getItem('theme') || defaultTheme;
        const lightThemes = ['clean-white', 'catppuccin-latte', 'rose-pine-dawn', 'nord-light', 'solarized-light', 'gruvbox-light', 'tokyo-night-light'];
        const isLight = lightThemes.includes(savedTheme);
        
        document.documentElement.setAttribute('data-theme', savedTheme);
        if (!isLight) {
          document.documentElement.classList.add('dark');
        }
      })();
    </script>
  </head>
  <body class="min-h-screen bg-background text-foreground antialiased flex flex-col">
    <Header currentPath={currentPath} />
    <main class="flex-1">
      <slot />
    </main>
    <Footer />
    <CommandPalette />
  </body>
</html>
